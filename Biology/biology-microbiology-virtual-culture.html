<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Microbiology Simulator: Antibiotic Sensitivity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #14b8a6; /* Teal */
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        .tool-btn {
            background-color: var(--border-color);
            border: 1px solid #334155;
            transition: all 0.2s ease;
        }
        .tool-btn.active, .tool-btn:hover {
            background-color: #334155;
            border-color: var(--accent-color);
            color: var(--accent-color);
        }
        .sim-button {
            background: var(--accent-color); color: var(--bg-color);
            transition: all .2s ease; box-shadow: 0 4px 10px rgba(0,0,0,.3);
        }
        .sim-button:hover { background: #2dd4bf; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,.4); }
        canvas { cursor: crosshair; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-cyan-400">Virtual Microbiology Lab</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Perform an antibiotic sensitivity test (Kirby-Bauer method) on different bacteria.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="glass-card shadow-2xl p-2 rounded-2xl lg:col-span-2">
                <canvas id="simulation-canvas" class="w-full h-[500px] md:h-[600px] rounded-lg"></canvas>
            </div>
            
            <div class="space-y-6">
                 <h2 class="text-2xl font-bold text-center text-slate-300">Lab Bench</h2>
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-teal-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>
                        Tools & Reagents
                    </h3>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                             <label for="bacteria-select" class="font-medium text-slate-300">Select Bacteria</label>
                            <select id="bacteria-select" class="w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white">
                                <option value="ecoli">Escherichia coli</option>
                                <option value="saureus">Staphylococcus aureus</option>
                            </select>
                        </div>
                        <p class="font-medium text-slate-300 !mt-6">Select a tool to use on the petri dish:</p>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="tool-inoculate" class="tool-btn p-2 rounded-lg text-center active">Inoculate</button>
                            <button id="tool-penicillin" class="tool-btn p-2 rounded-lg text-center">Penicillin</button>
                            <button id="tool-tetracycline" class="tool-btn p-2 rounded-lg text-center">Tetracycline</button>
                            <button id="tool-ciprofloxacin" class="tool-btn p-2 rounded-lg text-center">Ciprofloxacin</button>
                        </div>
                    </div>
                </div>

                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-teal-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M12 18v-6"></path><path d="M9 15h6"></path></svg>
                        Incubator & Results
                    </h3>
                     <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Incubation Time: <span id="time-val" class="font-mono text-white">0 hours</span></p>
                        <p class="flex justify-between text-slate-400">Status: <span id="status-val" class="font-mono font-semibold text-white">Ready to Inoculate</span></p>
                    </div>
                    <div class="flex gap-4 pt-4">
                        <button id="incubate-btn" class="w-full sim-button font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M8 5v14l11-7z"></path></svg>
                            <span id="play-pause-text">Incubate (24h)</span>
                        </button>
                        <button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700">Reset Dish</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    
    const toolBtns = {
        inoculate: document.getElementById('tool-inoculate'),
        penicillin: document.getElementById('tool-penicillin'),
        tetracycline: document.getElementById('tool-tetracycline'),
        ciprofloxacin: document.getElementById('tool-ciprofloxacin'),
    };
    const bacteriaSelect = document.getElementById('bacteria-select');
    const timeVal = document.getElementById('time-val');
    const statusVal = document.getElementById('status-val');
    const incubateBtn = document.getElementById('incubate-btn');
    const resetBtn = document.getElementById('reset-btn');
    
    const SENSITIVITY = {
        ecoli: { penicillin: 0, tetracycline: 19, ciprofloxacin: 25 }, // Zone diameters in mm
        saureus: { penicillin: 29, tetracycline: 22, ciprofloxacin: 22 },
    };
    const ANTIBIOTIC_LABELS = {
        penicillin: 'P', tetracycline: 'TE', ciprofloxacin: 'CIP'
    };

    let state = { tool: 'inoculate', bacteria: 'ecoli' };
    let sim = { running: false, time: 0, colonies: [], discs: [] };
    let rafId = null;

    function resizeCanvas() {
        const simRect = canvas.parentElement.getBoundingClientRect();
        canvas.width = simRect.width;
        canvas.height = simRect.height > 100 ? simRect.height : 600;
        draw();
    }

    function resetSimulation() {
        if(sim.running) {
            cancelAnimationFrame(rafId);
            rafId = null;
        }
        sim = { running: false, time: 0, colonies: [], discs: [] };
        statusVal.textContent = 'Ready to Inoculate';
        incubateBtn.disabled = true;
        draw();
    }
    
    function updateState(newTool) {
        state.tool = newTool;
        Object.values(toolBtns).forEach(btn => btn.classList.remove('active'));
        toolBtns[newTool].classList.add('active');
    }

    function loop() {
        if (!sim.running) return;
        sim.time += 0.2; // Accelerated time
        
        // Grow colonies
        sim.colonies.forEach(colony => {
            let inhibited = false;
            for(const disc of sim.discs) {
                const dist = Math.hypot(colony.x - disc.x, colony.y - disc.y);
                if (dist < disc.zoneRadius) {
                    inhibited = true;
                    break;
                }
            }
            if (!inhibited && colony.radius < 4) {
                colony.radius += 0.1;
            }
        });
        
        timeVal.textContent = `${Math.floor(sim.time)} hours`;
        if (sim.time >= 24) {
            sim.running = false;
            statusVal.textContent = 'Growth Complete';
        }
        
        draw();
        if (sim.running) rafId = requestAnimationFrame(loop);
    }

    function draw() {
        const dishRadius = Math.min(canvas.width, canvas.height) / 2 - 40;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        // Background
        ctx.fillStyle = '#0f172a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Agar
        ctx.fillStyle = '#fde68a'; // Agar color
        ctx.beginPath();
        ctx.arc(centerX, centerY, dishRadius, 0, Math.PI * 2);
        ctx.fill();

        // Colonies
        ctx.fillStyle = 'rgba(240, 235, 220, 0.8)';
        sim.colonies.forEach(c => {
            ctx.beginPath();
            ctx.arc(c.x, c.y, c.radius, 0, Math.PI * 2);
            ctx.fill();
        });

        // Zones of Inhibition first
        ctx.globalAlpha = 0.5;
        sim.discs.forEach(disc => {
            ctx.fillStyle = '#fde68a'; // Clear zone, same as agar
            ctx.beginPath();
            ctx.arc(disc.x, disc.y, disc.zoneRadius, 0, Math.PI * 2);
            ctx.fill();
        });
        ctx.globalAlpha = 1;

        // Antibiotic Discs
        sim.discs.forEach(disc => {
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(disc.x, disc.y, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.stroke();
            
            ctx.fillStyle = 'black';
            ctx.font = 'bold 10px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(ANTIBIOTIC_LABELS[disc.type], disc.x, disc.y);
        });

        // Petri dish outline
        ctx.strokeStyle = '#94a3b8';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.arc(centerX, centerY, dishRadius, 0, Math.PI * 2);
        ctx.stroke();
    }
    
    function handleCanvasClick(e) {
        if(sim.running) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const dishRadius = Math.min(canvas.width, canvas.height) / 2 - 40;
        const distFromCenter = Math.hypot(x - canvas.width/2, y - canvas.height/2);

        if (distFromCenter > dishRadius) return; // Click outside dish

        if (state.tool === 'inoculate') {
            sim.colonies = [];
            for (let i = 0; i < 2000; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * dishRadius;
                sim.colonies.push({
                    x: canvas.width/2 + Math.cos(angle) * radius,
                    y: canvas.height/2 + Math.sin(angle) * radius,
                    radius: 1
                });
            }
            statusVal.textContent = 'Inoculated. Place antibiotics.';
            incubateBtn.disabled = false;
        } else { // Placing an antibiotic
            const scale = dishRadius / 100; // 100mm standard dish
            const zoneDiameter_mm = SENSITIVITY[state.bacteria][state.tool];
            sim.discs.push({
                x, y, type: state.tool,
                zoneRadius: (zoneDiameter_mm / 2) * scale
            });
        }
        draw();
    }
    
    // --- Event Handlers ---
    Object.keys(toolBtns).forEach(key => {
        toolBtns[key].addEventListener('click', () => updateState(key));
    });
    bacteriaSelect.addEventListener('change', e => {
        state.bacteria = e.target.value;
        resetSimulation();
    });
    incubateBtn.addEventListener('click', () => {
        if(sim.colonies.length === 0) {
            statusVal.textContent = "Please inoculate the dish first!";
            return;
        }
        sim.running = true;
        statusVal.textContent = "Incubating...";
        loop();
    });
    resetBtn.addEventListener('click', resetSimulation);
    canvas.addEventListener('click', handleCanvasClick);
    window.addEventListener('resize', resizeCanvas);
    
    resetSimulation();
})();
</script>
</body>
</html>

