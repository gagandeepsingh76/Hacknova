<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Carbon Cycle & Climate Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #84cc16; /* Lime Green */
            --co2-color: #f472b6;
            --temp-color: #ef4444;
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(132, 204, 22, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(132, 204, 22, 0.4); }
        .sim-button {
            background: var(--accent-color); color: var(--bg-color);
            transition: all .2s ease; box-shadow: 0 4px 10px rgba(0,0,0,.3);
        }
        .sim-button:hover { background: #a3e635; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,.4); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-lime-400 to-emerald-400">Carbon Cycle & Climate Simulator</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Model the impact of carbon fluxes on atmospheric CO₂ and global temperature over 150 years.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Simulation Canvas -->
            <div class="glass-card shadow-2xl p-2 rounded-2xl lg:col-span-2">
                <canvas id="simulation-canvas" class="w-full h-[500px] md:h-[600px] rounded-lg"></canvas>
            </div>
            
            <!-- Controls & Analysis Column -->
            <div class="space-y-6">
                 <h2 class="text-2xl font-bold text-center text-slate-300">Climate Model Parameters</h2>
                <!-- Carbon Flux Controls -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-lime-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12.22 2h-4.44a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.88Z"></path><path d="M12.22 2 18 8.88V13h-6V2Z"></path></svg>
                        Carbon Fluxes (GtC/year)
                    </h3>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                            <label for="emissions" class="font-medium text-slate-300 flex justify-between">Industrial Emissions: <span id="emissions-val">10.0</span></label>
                            <input type="range" id="emissions" min="0" max="20" step="0.5" value="10">
                        </div>
                        <div>
                            <label for="land-use" class="font-medium text-slate-300 flex justify-between">Land Use Change: <span id="land-use-val">1.5</span></label>
                            <input type="range" id="land-use" min="0" max="5" step="0.1" value="1.5">
                        </div>
                        <div>
                            <label for="ocean-sink" class="font-medium text-slate-300 flex justify-between">Ocean Sink Efficiency: <span id="ocean-sink-val">100%</span></label>
                            <input type="range" id="ocean-sink" min="50" max="150" step="1" value="100">
                        </div>
                         <div>
                            <label for="land-sink" class="font-medium text-slate-300 flex justify-between">Land Sink Efficiency: <span id="land-sink-val">100%</span></label>
                            <input type="range" id="land-sink" min="50" max="150" step="1" value="100">
                        </div>
                    </div>
                </div>

                <!-- Live Data & Time Controls -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-lime-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
                        Live Analysis
                    </h3>
                     <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Year: <span id="year-val" class="font-mono text-white">1850</span></p>
                        <p class="flex justify-between text-slate-400">Atmospheric CO₂: <span id="co2-val" class="font-mono font-semibold" style="color:var(--co2-color)">280 ppm</span></p>
                        <p class="flex justify-between text-slate-400">Temp. Anomaly: <span id="temp-val" class="font-mono font-semibold" style="color:var(--temp-color)">+0.00°C</span></p>
                    </div>
                     <div>
                        <label for="time-speed" class="font-medium text-slate-300 text-sm flex justify-between">Simulation Speed: <span id="speed-val">x10</span></label>
                        <input type="range" id="time-speed" min="1" max="50" step="1" value="10">
                    </div>
                    <div class="flex gap-4 pt-2">
                        <button id="play-pause-btn" class="w-full sim-button font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M8 5v14l11-7z"></path></svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2 hidden"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                            <span id="play-pause-text">Start</span>
                        </button>
                        <button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700 transition-colors flex items-center justify-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    
    const inputs = {
        emissions: document.getElementById('emissions'),
        landUse: document.getElementById('land-use'),
        oceanSink: document.getElementById('ocean-sink'),
        landSink: document.getElementById('land-sink'),
        timeSpeed: document.getElementById('time-speed'),
    };
    const valueSpans = {
        emissions: document.getElementById('emissions-val'),
        landUse: document.getElementById('land-use-val'),
        oceanSink: document.getElementById('ocean-sink-val'),
        landSink: document.getElementById('land-sink-val'),
        timeSpeed: document.getElementById('speed-val'),
    };
     const analysis = {
        year: document.getElementById('year-val'),
        co2: document.getElementById('co2-val'),
        temp: document.getElementById('temp-val'),
    };
    
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playPauseText = document.getElementById('play-pause-text');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const resetBtn = document.getElementById('reset-btn');

    let state = { emissions: 10, landUse: 1.5, oceanSink: 100, landSink: 100, timeSpeed: 10 };
    let sim = { year: 1850, co2: 280, running: false, history: [], particles: [] };
    let rafId = null;
    const DT = 0.016; 
    const PPM_PER_GTC = 0.47;
    const CLIMATE_SENSITIVITY = 3.0; // °C increase for CO2 doubling

    function resizeCanvas() {
        const simRect = canvas.parentElement.getBoundingClientRect();
        canvas.width = simRect.width;
        canvas.height = simRect.height > 100 ? simRect.height : 600;
        draw();
    }

    function resetSimulation() {
        if (sim.running) togglePlayPause();
        updateStateFromInputs();
        sim.year = 1850;
        sim.co2 = 280;
        sim.history = [];
        sim.particles = [];
        updateAnalysisDisplay();
        draw();
    }
    
    function updateStateFromInputs() {
        Object.keys(inputs).forEach(key => {
            const el = inputs[key];
            const span = valueSpans[key];
            let value = parseFloat(el.value);
            state[key] = value;
            if (key.includes('Sink')) span.textContent = `${value.toFixed(0)}%`;
            else if (key.includes('Speed')) span.textContent = `x${value.toFixed(0)}`;
            else span.textContent = value.toFixed(1);
        });
    }

    function physicsStep() {
        const timeMultiplier = state.timeSpeed * DT;
        const co2_excess_ratio = (sim.co2 - 280) / 280;
        
        const ocean_uptake = (2.5 * (state.oceanSink / 100)) * Math.max(0, co2_excess_ratio);
        const land_uptake = (2.5 * (state.landSink / 100)) * Math.max(0, co2_excess_ratio);
        
        const net_flux_gtc = state.emissions + state.landUse - ocean_uptake - land_uptake;
        const net_flux_ppm = net_flux_gtc * PPM_PER_GTC;
        
        sim.co2 += net_flux_ppm * timeMultiplier;
        sim.year += timeMultiplier;
        
        updateParticles(net_flux_gtc, ocean_uptake, land_uptake);

        if (sim.history.length === 0 || sim.year - sim.history[sim.history.length-1].year >= 1) {
            const temp_anomaly = CLIMATE_SENSITIVITY * Math.log2(sim.co2 / 280);
            sim.history.push({ year: sim.year, co2: sim.co2, temp: temp_anomaly });
            if (sim.history.length > 200) sim.history.shift();
        }
    }
    
    function updateAnalysisDisplay() {
        const temp_anomaly = CLIMATE_SENSITIVITY * Math.log2(sim.co2 / 280);
        analysis.year.textContent = Math.floor(sim.year);
        analysis.co2.textContent = `${sim.co2.toFixed(1)} ppm`;
        analysis.temp.textContent = `+${temp_anomaly.toFixed(2)}°C`;
    }

    function loop() {
        if (!sim.running) return;
        physicsStep();
        updateAnalysisDisplay();
        draw();
        rafId = requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawScene();
        drawParticles();
        drawGraph();
    }
    
    function drawScene() {
        const cW = canvas.width, cH = canvas.height;
        // Atmosphere
        const temp_anomaly = CLIMATE_SENSITIVITY * Math.log2(sim.co2 / 280);
        const skyHue = 200 - temp_anomaly * 20;
        const skyLightness = 50 - temp_anomaly * 5;
        ctx.fillStyle = `hsl(${skyHue}, 60%, ${skyLightness}%)`;
        ctx.fillRect(0, 0, cW, cH);

        // Ground
        ctx.fillStyle = '#5d4037';
        ctx.beginPath();
        ctx.moveTo(0, cH);
        ctx.lineTo(0, cH - 150);
        ctx.bezierCurveTo(cW/4, cH-200, cW/2, cH-120, cW, cH-180);
        ctx.lineTo(cW, cH);
        ctx.closePath();
        ctx.fill();

        // Ocean
        ctx.fillStyle = '#1e3a8a';
        ctx.beginPath();
        ctx.moveTo(cW, cH);
        ctx.lineTo(cW, cH-180);
        ctx.bezierCurveTo(cW*0.75, cH-220, cW*0.6, cH-150, cW*0.5, cH-150);
        ctx.lineTo(cW*0.5, cH);
        ctx.closePath();
        ctx.fill();
    }

    function updateParticles(emission, ocean, land) {
        // Add new particles
        if(Math.random() < emission * 0.1) sim.particles.push({x: canvas.width * 0.2, y: canvas.height-180, vx: Math.random()-0.5, vy: -1 - Math.random(), type:'emission'});
        if(Math.random() < land * 0.2) sim.particles.push({x: Math.random()*canvas.width, y: 10, vx: 0, vy: 1, type:'land_sink'});
        if(Math.random() < ocean * 0.2) sim.particles.push({x: Math.random()*canvas.width, y: 10, vx: 0, vy: 1, type:'ocean_sink'});

        // Move and remove particles
        for (let i = sim.particles.length - 1; i >= 0; i--) {
            const p = sim.particles[i];
            p.x += p.vx; p.y += p.vy;
            if(p.y > canvas.height-160 || p.y < 0) sim.particles.splice(i,1);
        }
    }

    function drawParticles() {
         sim.particles.forEach(p => {
             if (p.type === 'emission') ctx.fillStyle = '#f87171';
             else ctx.fillStyle = '#6ee7b7';
             ctx.beginPath();
             ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
             ctx.fill();
         });
    }

    function drawGraph() {
        const g = { x: 50, y: 50, w: canvas.width-100, h: 150 };
        ctx.fillStyle = 'rgba(2, 6, 23, 0.5)';
        ctx.fillRect(g.x, g.y, g.w, g.h);
        
        if (sim.history.length < 2) return;
        
        const maxCO2 = Math.max(300, ...sim.history.map(h => h.co2));
        const maxTemp = Math.max(1, ...sim.history.map(h => h.temp));
        
        // CO2 plot
        ctx.strokeStyle = 'var(--co2-color)'; ctx.lineWidth=2; ctx.beginPath();
        sim.history.forEach((p, i) => {
            const x = g.x + ((p.year - 1850) / 150) * g.w;
            const y = g.y + g.h - ((p.co2 - 280) / (maxCO2 - 280)) * g.h;
            if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();

        // Temp plot
        ctx.strokeStyle = 'var(--temp-color)'; ctx.lineWidth=2; ctx.beginPath();
        sim.history.forEach((p, i) => {
            const x = g.x + ((p.year - 1850) / 150) * g.w;
            const y = g.y + g.h - (p.temp / maxTemp) * g.h;
             if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
    }
    
    function togglePlayPause() {
        sim.running = !sim.running;
        if (sim.running) {
            playPauseText.textContent = 'Pause';
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            loop();
        } else {
            playPauseText.textContent = 'Play';
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            if(rafId) cancelAnimationFrame(rafId);
        }
    }

    // --- Event Handlers ---
    Object.values(inputs).forEach(input => input.addEventListener('input', updateStateFromInputs));
    playPauseBtn.addEventListener('click', togglePlayPause);
    resetBtn.addEventListener('click', resetSimulation);
    window.addEventListener('resize', resizeCanvas);
    
    resetSimulation();
})();
</script>
</body>
</html>

