<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Simple Harmonic Motion Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #38bdf8;
            --energy-ke: #10b981;    /* Green */
            --energy-pe: #f59e0b;    /* Orange */
            --pos-color: #f472b6;      /* Pink */
            --vel-color: #a78bfa;      /* Violet */
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.4); }
        .sim-button {
            background: var(--accent-color); color: var(--bg-color);
            transition: all .2s ease; box-shadow: 0 4px 10px rgba(0,0,0,.3);
        }
        .sim-button:hover { background: #0ea5e9; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,.4); }
        canvas { touch-action: none; cursor: grab; }
        canvas:active { cursor: grabbing; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-300 to-cyan-400">Simple Harmonic Motion Simulator</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Explore oscillations by dragging the mass and adjusting its physical properties.</p>
        </header>

        <div class="glass-card shadow-2xl p-2 rounded-2xl mb-6">
            <canvas id="simulation-canvas" class="w-full h-[550px] md:h-[600px] rounded-lg"></canvas>
        </div>
        
        <div>
            <h2 class="text-2xl font-bold text-center mb-4 text-slate-300">Control Deck</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- System Properties -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-sky-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                        System Properties
                    </h3>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                            <label for="mass" class="font-medium text-slate-300 flex justify-between">Mass: <span id="mass-val">1.0 kg</span></label>
                            <input type="range" id="mass" min="0.1" max="5.0" step="0.1" value="1.0">
                        </div>
                        <div>
                            <label for="spring-const" class="font-medium text-slate-300 flex justify-between">Spring Constant (k): <span id="k-val">10 N/m</span></label>
                            <input type="range" id="spring-const" min="1" max="50" step="1" value="10">
                        </div>
                         <div>
                            <label for="damping" class="font-medium text-slate-300 flex justify-between">Damping: <span id="damp-val-slider">0.1</span></label>
                            <input type="range" id="damping" min="0" max="5" step="0.05" value="0.1">
                        </div>
                        <div>
                            <label for="initial-disp" class="font-medium text-slate-300 flex justify-between">Initial Displacement: <span id="disp-val">0.5 m</span></label>
                            <input type="range" id="initial-disp" min="0.1" max="1.0" step="0.05" value="0.5">
                        </div>
                    </div>
                </div>

                <!-- Analysis -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-sky-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                        Analysis
                    </h3>
                    <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Period (T): <span id="period-val" class="font-mono text-white">1.99 s</span></p>
                        <p class="flex justify-between text-slate-400">Frequency (f): <span id="freq-val" class="font-mono text-white">0.50 Hz</span></p>
                        <p class="flex justify-between text-slate-400">Ang. Frequency (ω): <span id="omega-val" class="font-mono text-white">3.16 rad/s</span></p>
                        <p class="flex justify-between text-slate-400">Damping Type: <span id="damp-type-val" class="font-mono text-white">Underdamped</span></p>
                         <div class="pt-4 text-xs">
                             <div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2" style="background:var(--pos-color)"></div>Position (x)</div>
                             <div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2" style="background:var(--vel-color)"></div>Velocity (v)</div>
                         </div>
                    </div>
                </div>
                
                <div class="glass-card shadow-lg p-5 rounded-2xl flex flex-col justify-center gap-4">
                     <button id="play-pause-btn" class="w-full sim-button font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M8 5v14l11-7z"/></svg>
                        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2 hidden"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        <span id="play-pause-text">Play</span>
                    </button>
                    <button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700 transition-colors flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 2v6h6"/><path d="M21 12A9 9 0 0 0 6 5.3L3 8"/><path d="M21 22v-6h-6"/><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"/></svg>
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    const inputs = {
        mass: document.getElementById('mass'),
        k: document.getElementById('spring-const'),
        damping: document.getElementById('damping'),
        x0: document.getElementById('initial-disp'),
    };
    const valueSpans = {
        mass: document.getElementById('mass-val'),
        k: document.getElementById('k-val'),
        damping: document.getElementById('damp-val-slider'),
        x0: document.getElementById('disp-val'),
    };
    const metrics = {
        period: document.getElementById('period-val'),
        freq: document.getElementById('freq-val'),
        omega: document.getElementById('omega-val'),
        dampType: document.getElementById('damp-type-val'),
    };
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playPauseText = document.getElementById('play-pause-text');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const resetBtn = document.getElementById('reset-btn');

    let state = { m: 1.0, k: 10, b: 0.1, x0: 0.5 };
    let sim = { t: 0, x: 0.5, v: 0, running: false, history: [], isDragging: false };
    let rafId = null;
    let origin = { x: 0, y: 0 }, scale = 300;
    const DT = 0.016; // Time step
    const MAX_HISTORY = 400;

    function resizeCanvas() {
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height > 100 ? rect.height : 600;
        origin = { x: canvas.width / 2, y: canvas.height * 0.25 };
        scale = (canvas.width / 2) - 80;
        draw();
    }

    function resetSimulation() {
        if (sim.running) togglePlayPause();
        updateStateFromInputs();
        sim.t = 0;
        sim.x = state.x0;
        sim.v = 0;
        sim.history = [];
        updateAnalysisMetrics();
        draw();
    }

    function updateStateFromInputs() {
        state.m = parseFloat(inputs.mass.value);
        state.k = parseFloat(inputs.k.value);
        state.b = parseFloat(inputs.damping.value);
        if (!sim.running && !sim.isDragging) {
            state.x0 = parseFloat(inputs.x0.value);
            sim.x = state.x0;
            sim.v = 0;
        }
        
        valueSpans.mass.textContent = `${state.m.toFixed(1)} kg`;
        valueSpans.k.textContent = `${state.k.toFixed(0)} N/m`;
        valueSpans.damping.textContent = `${state.b.toFixed(2)}`;
        valueSpans.x0.textContent = `${state.x0.toFixed(2)} m`;
    }

    function updateAnalysisMetrics() {
        const omega0 = Math.sqrt(state.k / state.m);
        const zeta = state.b / (2 * Math.sqrt(state.m * state.k));
        let T=0, f=0;

        if (zeta < 1) { // Underdamped
            const omega_d = omega0 * Math.sqrt(1 - zeta*zeta);
            T = 2 * Math.PI / omega_d;
            f = 1 / T;
            metrics.dampType.textContent = 'Underdamped';
        } else if (zeta > 1) { // Overdamped
            metrics.dampType.textContent = 'Overdamped';
            T = Infinity; f = 0;
        } else { // Critically damped
            metrics.dampType.textContent = 'Critically Damped';
            T = Infinity; f = 0;
        }
        
        metrics.period.textContent = isFinite(T) ? `${T.toFixed(2)} s` : '∞';
        metrics.freq.textContent = isFinite(f) ? `${f.toFixed(2)} Hz` : '0 Hz';
        metrics.omega.textContent = `${omega0.toFixed(2)} rad/s`;
    }

    function physicsStep() {
        const F_spring = -state.k * sim.x;
        const F_damp = -state.b * sim.v;
        const a = (F_spring + F_damp) / state.m;
        sim.v += a * DT;
        sim.x += sim.v * DT;
        sim.t += DT;

        sim.history.push({ t: sim.t, x: sim.x, v: sim.v });
        if (sim.history.length > MAX_HISTORY) sim.history.shift();
    }

    function loop() {
        if (!sim.running) return;
        physicsStep();
        draw();
        rafId = requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawSystem();
        drawEnergyUI();
        drawGraph();
    }

    function drawSystem() {
        // Wall
        ctx.fillStyle = '#334155';
        ctx.fillRect(0, origin.y - 40, 40, 80);

        // Spring
        const springStart = 40;
        const massEdge = origin.x + sim.x * scale - 25;
        drawSpring(springStart, origin.y, massEdge, origin.y, 20);

        // Mass
        const massSize = 20 + state.m * 6;
        ctx.fillStyle = 'var(--accent-color)';
        ctx.fillRect(origin.x + sim.x * scale - massSize / 2, origin.y - massSize / 2, massSize, massSize);
        ctx.strokeStyle = '#020617';
        ctx.strokeRect(origin.x + sim.x * scale - massSize / 2, origin.y - massSize / 2, massSize, massSize);

        // Equilibrium line
        ctx.strokeStyle = '#475569';
        ctx.setLineDash([2, 3]);
        ctx.beginPath();
        ctx.moveTo(origin.x, origin.y - 50);
        ctx.lineTo(origin.x, origin.y + 50);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Floor
        ctx.fillStyle = '#1e293b';
        ctx.fillRect(0, origin.y + massSize/2, canvas.width, 20);
    }
    
    function drawSpring(x1, y1, x2, y2, coils) {
        ctx.strokeStyle = '#94a3b8';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        const dx = x2 - x1;
        const dy = y2 - y1;
        const length = Math.sqrt(dx*dx + dy*dy);
        const coilWidth = 15;
        
        for(let i=1; i < coils; i++) {
            const ratio = i / coils;
            const perpX = -dy / length * coilWidth;
            const perpY = dx / length * coilWidth;
            const sign = (i % 2 === 0) ? 1 : -1;
            ctx.lineTo(x1 + dx * ratio + perpX * sign, y1 + dy * ratio + perpY * sign);
        }
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }
    
    function drawEnergyUI() {
        const chartHeight = 100;
        const PE = 0.5 * state.k * sim.x * sim.x;
        const KE = 0.5 * state.m * sim.v * sim.v;
        const maxPE = 0.5 * state.k * state.x0 * state.x0;
        const maxEnergy = Math.max(0.1, maxPE);

        const keHeight = (KE / maxEnergy) * chartHeight;
        const peHeight = (PE / maxEnergy) * chartHeight;

        drawBar(canvas.width - 120, canvas.height - 20, 30, keHeight, 'var(--energy-ke)', 'KE');
        drawBar(canvas.width - 70, canvas.height - 20, 30, peHeight, 'var(--energy-pe)', 'PE');
    }

    function drawBar(x, y, w, h, color, label) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y - h, w, h);
        ctx.fillStyle = '#e2e8f0';
        ctx.font = '12px Inter';
        ctx.textAlign = 'center';
        ctx.fillText(label, x + w / 2, y + 15);
    }
    
    function drawGraph() {
        const g = { x: 50, y: canvas.height * 0.5, w: canvas.width - 100, h: canvas.height * 0.4 };
        ctx.strokeStyle = '#334155';
        ctx.strokeRect(g.x, g.y, g.w, g.h);
        if (sim.history.length < 2) return;

        const tStart = sim.history[0].t;
        const tEnd = sim.history[sim.history.length - 1].t;
        const timeWindow = Math.max(2 * (metrics.period.textContent.includes('s') ? parseFloat(metrics.period.textContent) : 4), tEnd - tStart);

        const xMax = state.x0 * 1.2;
        const vMax = Math.sqrt(state.k/state.m) * state.x0 * 1.2;

        function plot(key, color) {
            ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.beginPath();
            sim.history.forEach((p, i) => {
                const x = g.x + ((p.t - tStart) / timeWindow) * g.w;
                const maxVal = key === 'x' ? xMax : vMax;
                const y = g.y + g.h / 2 - (p[key] / maxVal) * (g.h / 2);
                if (x > g.x + g.w) return;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        plot('x', 'var(--pos-color)');
        plot('v', 'var(--vel-color)');
    }
    
    function togglePlayPause() {
        sim.running = !sim.running;
        if (sim.running) {
            playPauseText.textContent = 'Pause';
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            loop();
        } else {
            playPauseText.textContent = 'Play';
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            if(rafId) cancelAnimationFrame(rafId);
        }
    }

    function handleInputChange(e) {
        updateStateFromInputs();
        updateAnalysisMetrics();
        if (!sim.running) draw();
    }
    
    function handleMouseDown(e) {
        if (sim.running) return;
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const massX = origin.x + sim.x * scale;
        if (Math.abs(mouseX - massX) < 40) {
            sim.isDragging = true;
            canvas.style.cursor = 'grabbing';
        }
    }

    function handleMouseMove(e) {
        if (!sim.isDragging) return;
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const newX = (mouseX - origin.x) / scale;
        sim.x = Math.max(-1, Math.min(1, newX)); // Clamp
        state.x0 = sim.x;
        inputs.x0.value = sim.x;
        valueSpans.x0.textContent = `${sim.x.toFixed(2)} m`;
        draw();
    }
    
    function handleMouseUp() {
        if (sim.isDragging) {
            sim.isDragging = false;
            canvas.style.cursor = 'grab';
            resetSimulation();
        }
    }

    // --- Initial Setup ---
    window.addEventListener('resize', resizeCanvas);
    Object.values(inputs).forEach(input => input.addEventListener('input', handleInputChange));
    playPauseBtn.addEventListener('click', togglePlayPause);
    resetBtn.addEventListener('click', resetSimulation);
    canvas.addEventListener('mousedown', handleMouseDown);
    canvas.addEventListener('mousemove', handleMouseMove);
    window.addEventListener('mouseup', handleMouseUp);
    
    resetSimulation();
})();
</script>
</body>
</html>

