<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Renewable Energy Site Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #84cc16; /* Lime Green */
            --solar-color: #f59e0b;
            --wind-color: #38bdf8;
            --hydro-color: #22c55e;
            --demand-color: #f472b6;
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(132, 204, 22, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(132, 204, 22, 0.4); }
        .sim-button {
            background: var(--accent-color); color: var(--bg-color);
            transition: all .2s ease; box-shadow: 0 4px 10px rgba(0,0,0,.3);
        }
        .sim-button:hover { background: #a3e635; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,.4); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-lime-400 to-emerald-400">Renewable Energy Site Simulator</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Balance solar, wind, and hydro generation against a 24-hour demand cycle to design a clean energy grid.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Simulation Canvas -->
            <div class="glass-card shadow-2xl p-2 rounded-2xl lg:col-span-2">
                <canvas id="simulation-canvas" class="w-full h-[500px] md:h-[600px] rounded-lg"></canvas>
            </div>
            
            <!-- Controls & Analysis Column -->
            <div class="space-y-6">
                 <h2 class="text-2xl font-bold text-center text-slate-300">Site Configuration</h2>
                <!-- Environment Controls -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-lime-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path></svg>
                        Generation Mix
                    </h3>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                            <label for="solar" class="font-medium text-slate-300 flex justify-between">Solar Panel Capacity: <span id="solar-val">100 MW</span></label>
                            <input type="range" id="solar" min="0" max="500" value="100">
                        </div>
                        <div>
                            <label for="wind" class="font-medium text-slate-300 flex justify-between">Wind Turbines: <span id="wind-val">50</span></label>
                            <input type="range" id="wind" min="0" max="200" value="50">
                        </div>
                        <div>
                            <label for="hydro" class="font-medium text-slate-300 flex justify-between">Hydro Power Output: <span id="hydro-val">75 MW</span></label>
                            <input type="range" id="hydro" min="0" max="300" value="75">
                        </div>
                    </div>
                </div>

                <!-- Analysis -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-lime-300 flex items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
                        24-Hour Energy Analysis
                    </h3>
                    <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Time of Day: <span id="time-val" class="font-mono text-white">00:00</span></p>
                        <p class="flex justify-between text-slate-400">Current Demand: <span id="demand-val" class="font-mono text-white">0 MW</span></p>
                        <p class="flex justify-between text-slate-400">Current Production: <span id="prod-val" class="font-mono text-white">0 MW</span></p>
                        <p class="flex justify-between text-slate-400">Grid Status: <span id="status-val" class="font-mono font-semibold text-green-400">SURPLUS</span></p>
                    </div>
                </div>
                
                <!-- Time Controls -->
                <div class="glass-card shadow-lg p-5 rounded-2xl flex flex-col justify-center gap-4">
                    <div>
                        <label for="time-speed" class="font-medium text-slate-300 text-sm flex justify-between">Simulation Speed: <span id="speed-val">x1</span></label>
                        <input type="range" id="time-speed" min="1" max="60" step="1" value="10">
                    </div>
                    <div class="flex gap-4">
                        <button id="play-pause-btn" class="w-full sim-button font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M8 5v14l11-7z"></path></svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2 hidden"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                            <span id="play-pause-text">Play</span>
                        </button>
                        <button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700 transition-colors flex items-center justify-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    
    const inputs = {
        solar: document.getElementById('solar'),
        wind: document.getElementById('wind'),
        hydro: document.getElementById('hydro'),
        timeSpeed: document.getElementById('time-speed'),
    };
    const valueSpans = {
        solar: document.getElementById('solar-val'),
        wind: document.getElementById('wind-val'),
        hydro: document.getElementById('hydro-val'),
        timeSpeed: document.getElementById('speed-val'),
    };
    const analysis = {
        time: document.getElementById('time-val'),
        demand: document.getElementById('demand-val'),
        production: document.getElementById('prod-val'),
        status: document.getElementById('status-val'),
    };
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playPauseText = document.getElementById('play-pause-text');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const resetBtn = document.getElementById('reset-btn');

    let state = { solar: 100, wind: 50, hydro: 75, timeSpeed: 10 };
    let sim = { hour: 0, running: false, history: new Array(24).fill(null) };
    let rafId = null;
    const DT = 0.016; // Time step

    function resizeCanvas() {
        const simRect = canvas.parentElement.getBoundingClientRect();
        canvas.width = simRect.width;
        canvas.height = simRect.height > 100 ? simRect.height : 600;
        draw();
    }

    function resetSimulation() {
        if (sim.running) togglePlayPause();
        updateStateFromInputs();
        sim.hour = 0;
        sim.history = new Array(24).fill(null);
        precomputeHistory();
        draw();
    }

    function updateStateFromInputs() {
        state.solar = parseFloat(inputs.solar.value);
        state.wind = parseFloat(inputs.wind.value);
        state.hydro = parseFloat(inputs.hydro.value);
        state.timeSpeed = parseFloat(inputs.timeSpeed.value);
        
        valueSpans.solar.textContent = `${state.solar.toFixed(0)} MW`;
        valueSpans.wind.textContent = `${state.wind.toFixed(0)}`;
        valueSpans.hydro.textContent = `${state.hydro.toFixed(0)} MW`;
        valueSpans.timeSpeed.textContent = `x${state.timeSpeed.toFixed(0)}`;
        
        precomputeHistory();
    }
    
    // Pre-calculate the full 24h cycle for graphing
    function precomputeHistory() {
        for (let h = 0; h < 24; h++) {
            const solarProd = state.solar * Math.max(0, Math.sin((h - 6) * Math.PI / 12));
            const windProd = (state.wind * 2) * (0.6 + Math.sin(h*2) * 0.4); // Wind turbines are ~2MW each
            const hydroProd = state.hydro;
            const demand = 300 + 150 * (Math.sin((h-9) * Math.PI / 12) + Math.sin((h-20) * Math.PI / 24));
            
            sim.history[h] = {
                solar: solarProd,
                wind: windProd,
                hydro: hydroProd,
                totalProd: solarProd + windProd + hydroProd,
                demand: demand
            };
        }
    }

    function physicsStep() {
        sim.hour += (state.timeSpeed / 3600) * (DT / 0.016) * 24; // 1 second at x1 = 1 hour sim
        if (sim.hour >= 24) sim.hour = 0;
        
        const currentHour = Math.floor(sim.hour);
        const data = sim.history[currentHour];
        
        analysis.time.textContent = `${String(currentHour).padStart(2, '0')}:${String(Math.floor((sim.hour % 1) * 60)).padStart(2, '0')}`;
        analysis.demand.textContent = `${data.demand.toFixed(0)} MW`;
        analysis.production.textContent = `${data.totalProd.toFixed(0)} MW`;
        
        if (data.totalProd >= data.demand) {
            analysis.status.textContent = `SURPLUS +${(data.totalProd - data.demand).toFixed(0)} MW`;
            analysis.status.style.color = 'var(--health-good)';
        } else {
            analysis.status.textContent = `DEFICIT -${(data.demand - data.totalProd).toFixed(0)} MW`;
            analysis.status.style.color = 'var(--health-poor)';
        }
    }

    function loop() {
        if (!sim.running) return;
        physicsStep();
        draw();
        rafId = requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawEnvironment();
        drawGraph();
    }
    
    function drawEnvironment() {
        // Sky
        const sunAngle = (sim.hour - 6) * Math.PI / 12;
        const sunY = Math.sin(sunAngle);
        const dayLight = Math.max(0, sunY);
        const nightLight = 1 - dayLight;
        const skyColor = `rgb(${50 * dayLight}, ${80 * dayLight}, ${150 * dayLight + 10 * nightLight})`;
        ctx.fillStyle = skyColor;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Ground
        ctx.fillStyle = `rgb(${50 * dayLight + 20 * nightLight}, ${80 * dayLight + 40 * nightLight}, ${20 * dayLight})`;
        ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

        // Sun
        if (dayLight > 0) {
            ctx.fillStyle = `rgba(253, 224, 71, ${dayLight})`;
            ctx.beginPath();
            ctx.arc(canvas.width/2 + Math.cos(sunAngle) * canvas.width/2.5, canvas.height - 100 - sunY * (canvas.height - 150), 40, 0, Math.PI*2);
            ctx.fill();
        }

        // Wind Turbines
        for (let i = 0; i < 3; i++) {
            const windSpeed = sim.history[Math.floor(sim.hour)].wind / (state.wind*2 || 1);
            drawTurbine(canvas.width * (0.2 + i * 0.3), canvas.height - 100, windSpeed);
        }
    }
    
    function drawTurbine(x, y, speed) {
        ctx.strokeStyle = '#e2e8f0';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(x, y-80);
        ctx.stroke();

        ctx.save();
        ctx.translate(x, y-80);
        ctx.rotate(sim.hour * speed * 20);
        
        ctx.fillStyle = '#bdc3c7';
        for(let i=0; i<3; i++) {
            ctx.rotate(Math.PI*2/3);
            ctx.beginPath();
            ctx.moveTo(0,0);
            ctx.lineTo(5, -5);
            ctx.lineTo(30, -5);
            ctx.lineTo(25, 5);
            ctx.lineTo(0,0);
            ctx.fill();
        }
        ctx.restore();
    }
    
    function drawGraph() {
        const g = { x: 50, y: canvas.height - 300, w: canvas.width - 100, h: 250 };
        ctx.fillStyle = 'rgba(2, 6, 23, 0.5)';
        ctx.fillRect(g.x, g.y, g.w, g.h);
        
        const maxProd = Math.max(...sim.history.map(p => p.totalProd));
        const maxDemand = Math.max(...sim.history.map(p => p.demand));
        const maxVal = Math.max(400, maxProd, maxDemand) * 1.2;

        function plot(key, color) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            sim.history.forEach((p, i) => {
                const x = g.x + (i / 23) * g.w;
                const y = g.y + g.h - (p[key] / maxVal) * g.h;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        function area(key, color, baseKey=null) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(g.x, g.y + g.h);
            sim.history.forEach((p, i) => {
                const x = g.x + (i / 23) * g.w;
                const baseValue = baseKey ? p[baseKey] : 0;
                const y = g.y + g.h - ((p[key] + baseValue) / maxVal) * g.h;
                ctx.lineTo(x, y);
            });
            if(baseKey) {
                 for(let i=sim.history.length-1; i>=0; i--) {
                    const p = sim.history[i];
                    const x = g.x + (i / 23) * g.w;
                    const y = g.y + g.h - (p[baseKey] / maxVal) * g.h;
                    ctx.lineTo(x, y);
                 }
            } else {
                ctx.lineTo(g.x + g.w, g.y + g.h);
            }
            ctx.closePath();
            ctx.fill();
        }
        
        area('solar', 'var(--solar-color)');
        area('wind', 'var(--wind-color)', 'solar');
        area('hydro', 'var(--hydro-color)', 'totalProd');
        
        plot('demand', 'var(--demand-color)');

        // Current time indicator
        const timeX = g.x + (sim.hour / 24) * g.w;
        ctx.strokeStyle = '#e2e8f0';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(timeX, g.y);
        ctx.lineTo(timeX, g.y + g.h);
        ctx.stroke();
    }
    
    function togglePlayPause() {
        sim.running = !sim.running;
        if (sim.running) {
            playPauseText.textContent = 'Pause';
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            loop();
        } else {
            playPauseText.textContent = 'Play';
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            if(rafId) cancelAnimationFrame(rafId);
        }
    }

    // --- Event Handlers ---
    Object.values(inputs).forEach(input => input.addEventListener('input', () => {
        updateStateFromInputs();
        if(!sim.running) draw();
    }));
    playPauseBtn.addEventListener('click', togglePlayPause);
    resetBtn.addEventListener('click', resetSimulation);
    window.addEventListener('resize', resizeCanvas);
    
    resetSimulation();
})();
</script>
</body>
</html>

