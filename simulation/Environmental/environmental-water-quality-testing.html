<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Water Quality Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #84cc16; /* Lime Green */
            --good-color: #22c55e;
            --moderate-color: #eab308;
            --poor-color: #ef4444;
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(132, 204, 22, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(132, 204, 22, 0.4); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-lime-400 to-emerald-400">Water Quality Simulator</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Visually test water by adjusting key parameters and see the real-time quality analysis.</p>
        </header>

        <div class="glass-card shadow-2xl p-2 rounded-2xl mb-6">
            <canvas id="simulation-canvas" class="w-full h-[450px] md:h-[500px] rounded-lg"></canvas>
        </div>
        
        <div>
            <h2 class="text-2xl font-bold text-center mb-4 text-slate-300">Control Deck</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Parameters -->
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4 md:col-span-2">
                    <h3 class="font-bold text-lg text-lime-300 flex items-center">
                       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
                        Water Parameters
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 pt-2 text-sm">
                        <div>
                            <label for="water-ph" class="font-medium text-slate-300 flex justify-between">pH Level: <span id="ph-val">7.0</span></label>
                            <input type="range" id="water-ph" min="3" max="11" step="0.1" value="7.0">
                        </div>
                        <div>
                            <label for="turbidity" class="font-medium text-slate-300 flex justify-between">Turbidity: <span id="turbidity-val">5 NTU</span></label>
                            <input type="range" id="turbidity" min="0" max="100" value="5">
                        </div>
                        <div>
                            <label for="dissolved-oxygen" class="font-medium text-slate-300 flex justify-between">Dissolved Oxygen: <span id="do-val">8.0 mg/L</span></label>
                            <input type="range" id="dissolved-oxygen" min="0" max="15" step="0.1" value="8.0">
                        </div>
                        <div>
                            <label for="water-temperature" class="font-medium text-slate-300 flex justify-between">Temperature: <span id="temp-val">20°C</span></label>
                            <input type="range" id="water-temperature" min="0" max="40" step="1" value="20">
                        </div>
                    </div>
                </div>

                <!-- Analysis -->
                <div class="glass-card shadow-lg p-5 rounded-2xl flex flex-col justify-center items-center text-center">
                    <h3 class="font-bold text-lg text-lime-300">Overall Water Quality</h3>
                    <div id="wqi-score" class="font-bold text-6xl my-4 text-green-400">95</div>
                    <div id="wqi-label" class="font-semibold text-xl text-green-400">Excellent</div>
                    <p class="text-xs text-slate-400 mt-2">Based on a calculated Water Quality Index (WQI)</p>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    const inputs = {
        ph: document.getElementById('water-ph'),
        turbidity: document.getElementById('turbidity'),
        d_oxygen: document.getElementById('dissolved-oxygen'),
        temp: document.getElementById('water-temperature'),
    };
    const valueSpans = {
        ph: document.getElementById('ph-val'),
        turbidity: document.getElementById('turbidity-val'),
        d_oxygen: document.getElementById('do-val'),
        temp: document.getElementById('temp-val'),
    };
    const analysis = {
        score: document.getElementById('wqi-score'),
        label: document.getElementById('wqi-label'),
    };

    let state = { ph: 7.0, turbidity: 5, d_oxygen: 8.0, temp: 20 };
    let particles = [];
    let rafId = null;

    function resizeCanvas() {
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height > 100 ? rect.height : 500;
        draw();
    }

    function updateStateFromInputs() {
        state.ph = parseFloat(inputs.ph.value);
        state.turbidity = parseFloat(inputs.turbidity.value);
        state.d_oxygen = parseFloat(inputs.d_oxygen.value);
        state.temp = parseFloat(inputs.temp.value);
        
        valueSpans.ph.textContent = state.ph.toFixed(1);
        valueSpans.turbidity.textContent = `${state.turbidity.toFixed(0)} NTU`;
        valueSpans.d_oxygen.textContent = `${state.d_oxygen.toFixed(1)} mg/L`;
        valueSpans.temp.textContent = `${state.temp.toFixed(0)}°C`;
        
        updateAnalysis();
        if (!rafId) draw(); // Only call draw if animation loop isn't running
    }
    
    function updateAnalysis() {
        const phScore = 100 * (1 - Math.abs(state.ph - 7.5) / 4.5);
        const turbidityScore = 100 * Math.max(0, 1 - state.turbidity / 50);
        const doScore = 100 * Math.min(1, state.d_oxygen / 9);
        const tempScore = 100 * (1 - Math.abs(state.temp - 18) / 22);

        // Weighted WQI
        const wqi = (phScore * 0.3) + (turbidityScore * 0.3) + (doScore * 0.3) + (tempScore * 0.1);
        const score = Math.max(0, Math.min(100, wqi)).toFixed(0);

        analysis.score.textContent = score;
        let label, color;
        if (score >= 90) { label = 'Excellent'; color = 'var(--good-color)'; }
        else if (score >= 70) { label = 'Good'; color = 'var(--good-color)'; }
        else if (score >= 50) { label = 'Fair'; color = 'var(--moderate-color)'; }
        else if (score >= 25) { label = 'Poor'; color = 'var(--poor-color)'; }
        else { label = 'Very Poor'; color = 'var(--poor-color)'; }

        analysis.label.textContent = label;
        analysis.score.style.color = color;
        analysis.label.style.color = color;
    }

    function loop() {
        draw();
        rafId = requestAnimationFrame(loop);
    }
    
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBeaker();
        drawGauges();
    }

    function drawBeaker() {
        const cW = canvas.width, cH = canvas.height;
        const beakerW = Math.min(250, cW * 0.4);
        const beakerH = beakerW * 1.5;
        const beakerX = (cW / 2) - beakerW / 2;
        const beakerY = (cH / 2) - beakerH / 2;

        // Water color based on pH
        const phColor = `hsl(${60 + (state.ph - 7) * 20}, 50%, 40%)`;
        ctx.fillStyle = phColor;
        ctx.globalAlpha = 1 - Math.min(1, state.turbidity / 100);
        ctx.fillRect(beakerX + 5, beakerY + 30, beakerW - 10, beakerH - 35);
        ctx.globalAlpha = 1;

        // Beaker outline
        ctx.strokeStyle = '#94a3b8';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(beakerX, beakerY);
        ctx.lineTo(beakerX, beakerY + beakerH);
        ctx.lineTo(beakerX + beakerW, beakerY + beakerH);
        ctx.lineTo(beakerX + beakerW, beakerY);
        ctx.stroke();

        // Water surface
        ctx.beginPath();
        ctx.moveTo(beakerX, beakerY + 30);
        ctx.lineTo(beakerX + beakerW, beakerY + 30);
        ctx.stroke();
        
        // Particles (turbidity) & Bubbles (DO)
        updateAndDrawParticles(beakerX, beakerY + 30, beakerW, beakerH - 30);
    }
    
    function updateAndDrawParticles(x, y, w, h) {
        // Turbidity particles
        while(particles.length < state.turbidity * 2) {
            particles.push({
                x: x + Math.random() * w, y: y + Math.random() * h,
                vx: (Math.random() - 0.5) * 0.1, vy: (Math.random() - 0.5) * 0.1,
                type: 'turbidity', size: Math.random() * 1.5 + 0.5
            });
        }
        while(particles.length > state.turbidity * 2) particles.shift();

        // DO bubbles
        if (Math.random() < state.d_oxygen / 20) {
            particles.push({
                x: x + 10 + Math.random() * (w - 20), y: y + h - 10,
                vx: 0, vy: -Math.random() * 0.5 - 0.2,
                type: 'bubble', size: Math.random() * 2 + 1
            });
        }

        ctx.fillStyle = 'rgba(200, 180, 150, 0.7)';
        ctx.strokeStyle = 'rgba(200, 220, 255, 0.8)';
        
        for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.x += p.vx; p.y += p.vy;
            if (p.x < x || p.x > x+w || p.y < y) {
                particles.splice(i, 1);
                continue;
            }
            
            if (p.type === 'turbidity') {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            } else { // Bubble
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
    }
    
    function drawGauges() {
        const cW = canvas.width, cH = canvas.height;
        const radius = Math.min(60, cW / 10);
        const positions = [
            { x: cW * 0.15, y: cH * 0.25 },
            { x: cW * 0.85, y: cH * 0.25 },
            { x: cW * 0.15, y: cH * 0.75 },
            { x: cW * 0.85, y: cH * 0.75 },
        ];
        
        drawGauge(positions[0].x, positions[0].y, radius, 'pH', state.ph, 3, 11, 6.5, 8.5);
        drawGauge(positions[1].x, positions[1].y, radius, 'Turbidity', state.turbidity, 0, 100, 0, 10);
        drawGauge(positions[2].x, positions[2].y, radius, 'D.O.', state.d_oxygen, 0, 15, 6, 15);
        drawGauge(positions[3].x, positions[3].y, radius, 'Temp', state.temp, 0, 40, 10, 25);
    }

    function drawGauge(x, y, r, label, value, min, max, goodMin, goodMax) {
        const startAngle = 0.75 * Math.PI, endAngle = 0.25 * Math.PI;
        
        // Background arc
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.arc(x, y, r, startAngle, endAngle);
        ctx.stroke();

        // Value arc
        const ratio = (value - min) / (max - min);
        const valueAngle = startAngle + ratio * (endAngle - startAngle + 2*Math.PI) % (2*Math.PI);
        
        let color = 'var(--poor-color)';
        if (value >= goodMin && value <= goodMax) color = 'var(--good-color)';
        else if (value >= goodMin-2 && value <= goodMax+2) color = 'var(--moderate-color)';

        ctx.strokeStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, r, startAngle, valueAngle);
        ctx.stroke();
        
        ctx.fillStyle = '#e2e8f0';
        ctx.font = '12px Inter';
        ctx.textAlign = 'center';
        ctx.fillText(label, x, y);
        ctx.font = 'bold 14px Inter';
        ctx.fillText(value.toFixed(1), x, y + 18);
    }
    
    // --- Event Handlers ---
    Object.values(inputs).forEach(input => input.addEventListener('input', updateStateFromInputs));
    window.addEventListener('resize', resizeCanvas);
    
    updateStateFromInputs();
    loop();
})();
</script>
</body>
</html>

