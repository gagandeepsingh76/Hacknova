<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Virtual Titration Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #10b981; /* Emerald */
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.4); }
        .sim-button {
            background: var(--accent-color); color: var(--bg-color);
            transition: all .2s ease; box-shadow: 0 4px 10px rgba(0,0,0,.3);
        }
        .sim-button:hover { background: #34d399; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,.4); }
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;
            padding-right: 2.5rem; -webkit-appearance: none; -moz-appearance: none; appearance: none;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-green-400">Virtual Titration Laboratory</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Simulate acid-base titrations, visualize pH changes, and plot the resulting curve in real-time.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="glass-card shadow-2xl p-2 rounded-2xl lg:col-span-2">
                <canvas id="simulation-canvas" class="w-full h-[500px] md:h-[600px] rounded-lg"></canvas>
            </div>
            
            <div class="space-y-6">
                 <h2 class="text-2xl font-bold text-center text-slate-300">Experiment Setup</h2>
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-emerald-300 flex items-center">
                       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                        Reagents
                    </h3>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                            <label for="titration-type" class="font-medium text-slate-300">Titration Type</label>
                            <select id="titration-type" class="w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white">
                                <option value="strong-strong">Strong Acid / Strong Base</option>
                                <option value="weak-strong">Weak Acid / Strong Base</option>
                                <option value="strong-weak">Strong Acid / Weak Base</option>
                            </select>
                        </div>
                        <div>
                            <label for="acid-conc" class="font-medium text-slate-300 flex justify-between">Analyte (Acid) Conc.: <span id="acid-val">0.100 M</span></label>
                            <input type="range" id="acid-conc" min="0.01" max="1.0" step="0.005" value="0.1">
                        </div>
                        <div>
                            <label for="base-conc" class="font-medium text-slate-300 flex justify-between">Titrant (Base) Conc.: <span id="base-val">0.100 M</span></label>
                            <input type="range" id="base-conc" min="0.01" max="1.0" step="0.005" value="0.1">
                        </div>
                         <p class="flex justify-between text-slate-400 !mt-6">Analyte Volume: <span class="font-mono text-white">50.0 mL</span></p>
                    </div>
                </div>

                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-emerald-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
                        Live Data
                    </h3>
                     <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Titrant Added: <span id="vol-val" class="font-mono text-white">0.0 mL</span></p>
                        <p class="flex justify-between text-slate-400">Current pH: <span id="ph-val" class="font-mono text-white text-2xl">1.00</span></p>
                        <p class="flex justify-between text-slate-400">Equivalence Point: <span id="equiv-val" class="font-mono font-semibold text-white">---</span></p>
                    </div>
                    <div class="flex gap-4 pt-4">
                        <button id="play-pause-btn" class="w-full sim-button font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M8 5v14l11-7z"></path></svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2 hidden"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                            <span id="play-pause-text">Start</span>
                        </button>
                        <button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700 transition-colors flex items-center justify-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    
    const inputs = {
        type: document.getElementById('titration-type'),
        acidConc: document.getElementById('acid-conc'),
        baseConc: document.getElementById('base-conc'),
    };
    const valueSpans = {
        acidConc: document.getElementById('acid-val'),
        baseConc: document.getElementById('base-val'),
    };
     const analysis = {
        volume: document.getElementById('vol-val'),
        ph: document.getElementById('ph-val'),
        equiv: document.getElementById('equiv-val'),
    };
    
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playPauseText = document.getElementById('play-pause-text');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const resetBtn = document.getElementById('reset-btn');

    let state = { type: 'strong-strong', Ca: 0.1, Cb: 0.1, Va: 50, Vb: 0, pKa: 4.76, pKb: 4.76 };
    let sim = { running: false, history: [], drops: [] };
    let rafId = null;

    function resizeCanvas() {
        const simRect = canvas.parentElement.getBoundingClientRect();
        canvas.width = simRect.width;
        canvas.height = simRect.height > 100 ? simRect.height : 600;
        draw();
    }

    function resetSimulation() {
        if (sim.running) togglePlayPause();
        updateStateFromInputs();
        state.Vb = 0;
        sim.history = [];
        sim.drops = [];
        analysis.equiv.textContent = '---';
        draw();
    }
    
    function updateStateFromInputs() {
        state.type = inputs.type.value;
        state.Ca = parseFloat(inputs.acidConc.value);
        state.Cb = parseFloat(inputs.baseConc.value);
        
        valueSpans.acidConc.textContent = `${state.Ca.toFixed(3)} M`;
        valueSpans.baseConc.textContent = `${state.Cb.toFixed(3)} M`;
    }
    
    function calculatePH(vb) {
        const { type, Ca, Cb, Va, pKa, pKb } = state;
        const Vtotal = Va + vb;
        const Ka = 10**-pKa, Kb = 10**-pKb;

        const initialMolesAcid = Ca * Va / 1000;
        const addedMolesBase = Cb * vb / 1000;

        if (type === 'strong-strong') {
            if (addedMolesBase < initialMolesAcid) {
                const H = (initialMolesAcid - addedMolesBase) / (Vtotal / 1000);
                return -Math.log10(H);
            } else if (addedMolesBase > initialMolesAcid) {
                const OH = (addedMolesBase - initialMolesAcid) / (Vtotal / 1000);
                return 14 + Math.log10(OH);
            } else {
                return 7;
            }
        } else if (type === 'weak-strong') {
             if (vb === 0) { // Initial weak acid
                return 0.5 * (pKa - Math.log10(Ca));
            } else if (addedMolesBase < initialMolesAcid) { // Buffer region
                const molesA = initialMolesAcid - addedMolesBase;
                const molesHA = addedMolesBase;
                return pKa + Math.log10(molesHA / molesA);
            } else if (addedMolesBase === initialMolesAcid) { // Equivalence point
                const M_A = initialMolesAcid / (Vtotal/1000);
                const OH = Math.sqrt((1e-14/Ka)*M_A);
                return 14 + Math.log10(OH);
            } else { // Excess strong base
                const OH = (addedMolesBase - initialMolesAcid) / (Vtotal / 1000);
                return 14 + Math.log10(OH);
            }
        } else { // strong-weak
             if (vb === 0) {
                 return -Math.log10(Ca);
             } else if (addedMolesBase < initialMolesAcid) {
                const H = (initialMolesAcid - addedMolesBase) / (Vtotal / 1000);
                return -Math.log10(H);
             } else if (addedMolesBase === initialMolesAcid) {
                const M_B = initialMolesAcid / (Vtotal/1000);
                const H = Math.sqrt((1e-14/Kb)*M_B);
                return -Math.log10(H);
             } else { // Buffer region post-equivalence
                const molesB = addedMolesBase - initialMolesAcid;
                const molesBH = initialMolesAcid;
                const pOH = pKb + Math.log10(molesBH / molesB);
                return 14 - pOH;
             }
        }
    }

    function physicsStep() {
        if (state.Vb >= 100) {
            togglePlayPause();
            return;
        }
        state.Vb += 0.2;
        if (Math.random() < 0.5) {
            sim.drops.push({x: canvas.width * 0.5, y: canvas.height * 0.2, vy: 2});
        }
        sim.history.push({ vol: state.Vb, ph: calculatePH(state.Vb) });
    }

    function loop() {
        if (!sim.running) return;
        physicsStep();
        draw();
        rafId = requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawLabware();
        drawTitrationCurve();
        updateAnalysisDisplay();
    }
    
    function drawLabware() {
        const cW = canvas.width, cH = canvas.height;
        const beakerX = cW/2 - 100, beakerY = cH * 0.6, beakerW = 200, beakerH = 200;
        
        // Beaker
        ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(beakerX, beakerY); ctx.lineTo(beakerX, beakerY + beakerH);
        ctx.lineTo(beakerX + beakerW, beakerY + beakerH); ctx.lineTo(beakerX + beakerW, beakerY);
        ctx.stroke();

        // Liquid in beaker
        const ph = calculatePH(state.Vb);
        const color = ph < 8.2 ? 'rgba(255,255,255,0.1)' : `rgba(236, 72, 153, ${Math.min(1, (ph - 8.2)/2)})`;
        ctx.fillStyle = color;
        ctx.fillRect(beakerX, beakerY + 50, beakerW, beakerH - 50);

        // Burette
        const buretteX = cW/2, buretteY = 50;
        ctx.fillRect(buretteX - 10, buretteY, 20, cH * 0.5);
        ctx.strokeRect(buretteX - 10, buretteY, 20, cH * 0.5);
        ctx.fillStyle = 'rgba(100, 180, 255, 0.3)';
        const buretteLevel = (state.Vb / 100) * (cH * 0.5);
        ctx.fillRect(buretteX - 10, buretteY + buretteLevel, 20, cH * 0.5 - buretteLevel);

        // Drops
        sim.drops.forEach((d, i) => {
            d.y += d.vy; d.vy += 0.2;
            ctx.fillStyle = 'rgba(100, 180, 255, 0.5)';
            ctx.beginPath(); ctx.arc(d.x, d.y, 3, 0, Math.PI * 2); ctx.fill();
            if(d.y > beakerY + 50) sim.drops.splice(i, 1);
        });
    }

    function drawTitrationCurve() {
        if(sim.history.length === 0) return;
        const g = { x: 50, y: 50, w: canvas.width * 0.3, h: canvas.height * 0.4 };
        ctx.fillStyle = 'rgba(2, 6, 23, 0.6)'; ctx.fillRect(g.x, g.y, g.w, g.h);
        ctx.strokeStyle = '#334155'; ctx.strokeRect(g.x, g.y, g.w, g.h);
        
        ctx.strokeStyle = 'var(--accent-color)'; ctx.lineWidth=2; ctx.beginPath();
        sim.history.forEach((p, i) => {
            const x = g.x + (p.vol / 100) * g.w;
            const y = g.y + g.h - (p.ph / 14) * g.h;
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // Equivalence point
        const equivVol = state.Ca * state.Va / state.Cb;
        if(state.Vb >= equivVol && analysis.equiv.textContent === '---') {
            const equivPH = calculatePH(equivVol);
            analysis.equiv.textContent = `${equivVol.toFixed(1)} mL (pH ${equivPH.toFixed(2)})`;
        }
        if (analysis.equiv.textContent !== '---') {
            const eqX = g.x + (equivVol / 100) * g.w;
            const eqY = g.y + g.h - (calculatePH(equivVol) / 14) * g.h;
            ctx.fillStyle = '#fbbf24';
            ctx.beginPath(); ctx.arc(eqX, eqY, 5, 0, Math.PI*2); ctx.fill();
        }
    }
    
    function updateAnalysisDisplay() {
        analysis.volume.textContent = `${state.Vb.toFixed(1)} mL`;
        analysis.ph.textContent = calculatePH(state.Vb).toFixed(2);
    }
    
    function togglePlayPause() {
        sim.running = !sim.running;
        if (sim.running) {
            playPauseText.textContent = 'Pause';
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            loop();
        } else {
            playPauseText.textContent = 'Start';
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            if(rafId) cancelAnimationFrame(rafId);
        }
    }

    // --- Event Handlers ---
    Object.values(inputs).forEach(input => input.addEventListener('input', () => {
        if(!sim.running) resetSimulation();
    }));
    playPauseBtn.addEventListener('click', togglePlayPause);
    resetBtn.addEventListener('click', resetSimulation);
    window.addEventListener('resize', resizeCanvas);
    
    resetSimulation();
})();
</script>
</body>
</html>

