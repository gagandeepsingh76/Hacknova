<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Chemical Equilibrium Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #10b981; /* Emerald */
            --reactant-color: 'rgba(59, 130, 246, 0.8)';
            --product-color: 'rgba(168, 85, 247, 0.8)';
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.4); }
        .sim-button {
            background-color: var(--border-color);
            border: 1px solid #334155;
            transition: all 0.2s ease;
        }
        .sim-button:hover {
            background-color: #334155;
            border-color: var(--accent-color);
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-green-400">Chemical Equilibrium & Le Chatelier's Principle</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Apply stress to a reversible reaction and observe how the system shifts to restore equilibrium.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="glass-card shadow-2xl p-2 rounded-2xl lg:col-span-2">
                <canvas id="simulation-canvas" class="w-full h-[500px] md:h-[600px] rounded-lg"></canvas>
            </div>
            
            <div class="space-y-6">
                 <h2 class="text-2xl font-bold text-center text-slate-300">System Controls</h2>
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-emerald-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12 22a7 7 0 0 0 7-7h-2a5 5 0 0 1-5 5v2z"></path><path d="M22 12h-2a5 5 0 0 1-5-5V5a7 7 0 0 0-7 7h2a5 5 0 0 1 5 5z"></path><path d="M2 12h2a5 5 0 0 1 5-5V5a7 7 0 0 0-7 7z"></path><path d="M12 2a7 7 0 0 0-7 7h2a5 5 0 0 1 5-5V2z"></path></svg>
                        Reaction Conditions
                    </h3>
                    <p class="text-center font-mono text-lg text-slate-300 pt-2">
                        <span style="color: var(--reactant-color)">A</span> ⇌ <span style="color: var(--product-color)">2B</span> (Exothermic)
                    </p>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                            <label for="temperature" class="font-medium text-slate-300 flex justify-between">Temperature: <span id="temp-val">300 K</span></label>
                            <input type="range" id="temperature" min="250" max="400" step="1" value="300">
                        </div>
                        <div>
                            <label for="volume" class="font-medium text-slate-300 flex justify-between">Volume / Pressure: <span id="vol-val">1.0</span></label>
                            <input type="range" id="volume" min="0.5" max="2.0" step="0.05" value="1.0">
                        </div>
                        <div class="grid grid-cols-2 gap-4 !mt-6">
                           <button id="add-a" class="sim-button py-2 rounded-lg">+ Add Reactant A</button>
                           <button id="add-b" class="sim-button py-2 rounded-lg">+ Add Product B</button>
                        </div>
                    </div>
                </div>

                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-emerald-300 flex items-center">
                       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
                        Live Analysis
                    </h3>
                     <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Concentration [A]: <span id="conc-a-val" class="font-mono text-white">0.00 M</span></p>
                        <p class="flex justify-between text-slate-400">Concentration [B]: <span id="conc-b-val" class="font-mono text-white">0.00 M</span></p>
                        <p class="flex justify-between text-slate-400">Reaction Quotient (Q): <span id="q-val" class="font-mono text-white">0.00</span></p>
                        <p class="flex justify-between text-slate-400">Equilibrium Constant (K): <span id="k-val" class="font-mono text-white">0.00</span></p>
                        <p id="shift-status" class="text-center font-semibold text-lg pt-4 text-emerald-400">At Equilibrium</p>
                    </div>
                    <div class="pt-4"><button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700 transition-colors">Reset System</button></div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    
    const inputs = {
        temperature: document.getElementById('temperature'),
        volume: document.getElementById('volume'),
    };
    const valueSpans = {
        temperature: document.getElementById('temp-val'),
        volume: document.getElementById('vol-val'),
    };
    const analysis = {
        concA: document.getElementById('conc-a-val'),
        concB: document.getElementById('conc-b-val'),
        q: document.getElementById('q-val'),
        k: document.getElementById('k-val'),
        shift: document.getElementById('shift-status'),
    };
    const addA_btn = document.getElementById('add-a');
    const addB_btn = document.getElementById('add-b');
    const resetBtn = document.getElementById('reset-btn');

    let state = { T: 300, V: 1.0, dH: -40000, K_ref: 10, T_ref: 298 };
    let sim = { particles: [], running: false };
    let rafId = null;

    function resizeCanvas() {
        const simRect = canvas.parentElement.getBoundingClientRect();
        canvas.width = simRect.width;
        canvas.height = simRect.height > 100 ? simRect.height : 600;
        loop();
    }

    function resetSimulation() {
        sim.particles = [];
        for(let i=0; i<50; i++) sim.particles.push(createAgent('A'));
        for(let i=0; i<50; i++) sim.particles.push(createAgent('B'));
        updateStateFromInputs();
        if(!sim.running) loop();
    }
    
    function createAgent(type) {
        return {
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: (Math.random() - 0.5) * 2,
            vy: (Math.random() - 0.5) * 2,
            type: type,
        };
    }

    function updateStateFromInputs() {
        state.T = parseFloat(inputs.temperature.value);
        state.V = parseFloat(inputs.volume.value);
        
        valueSpans.temperature.textContent = `${state.T.toFixed(0)} K`;
        valueSpans.volume.textContent = state.V.toFixed(2);
    }
    
    function physicsStep() {
        // Van't Hoff Equation to find K
        const R = 8.314;
        const K = state.K_ref * Math.exp((-state.dH / R) * (1 / state.T - 1 / state.T_ref));
        
        const countA = sim.particles.filter(p => p.type === 'A').length;
        const countB = sim.particles.filter(p => p.type === 'B').length;
        const concA = countA / state.V;
        const concB = countB / state.V;
        
        // Reaction Quotient Q
        const Q = (concB * concB) / concA;

        analysis.concA.textContent = `${concA.toFixed(2)} M`;
        analysis.concB.textContent = `${concB.toFixed(2)} M`;
        analysis.q.textContent = Q.toFixed(2);
        analysis.k.textContent = K.toFixed(2);
        
        if (Math.abs(Q - K) < K * 0.05) {
            analysis.shift.textContent = 'At Equilibrium';
            analysis.shift.style.color = 'var(--accent-color)';
        } else if (Q < K) {
            analysis.shift.textContent = '→ Shifting Right →';
            analysis.shift.style.color = 'var(--product-color)';
            // A -> 2B
            const A_agent = sim.particles.find(p => p.type === 'A');
            if(A_agent && Math.random() < 0.1) {
                A_agent.type = 'B';
                sim.particles.push(createAgent('B'));
            }
        } else {
            analysis.shift.textContent = '← Shifting Left ←';
            analysis.shift.style.color = 'var(--reactant-color)';
            // 2B -> A
            const b_agents = sim.particles.filter(p => p.type === 'B');
            if(b_agents.length >= 2 && Math.random() < 0.1) {
                b_agents[0].type = 'A';
                sim.particles.splice(sim.particles.indexOf(b_agents[1]), 1);
            }
        }

        // Move particles
        const speed = Math.sqrt(state.T/300);
        sim.particles.forEach(p => moveAgent(p, speed));
    }
    
    function moveAgent(agent, speed) {
        const bounds = getVesselBounds();
        agent.x += agent.vx * speed;
        agent.y += agent.vy * speed;
        if (agent.x < bounds.x || agent.x > bounds.x + bounds.w) agent.vx *= -1;
        if (agent.y < bounds.y || agent.y > bounds.y + bounds.h) agent.vy *= -1;
    }

    function loop() {
        physicsStep();
        draw();
        rafId = requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawVessel();
        sim.particles.forEach(p => drawAgent(p));
    }
    
    function getVesselBounds() {
        const vesselHeight = canvas.height - 40;
        const vesselWidth = (canvas.width - 40) / 2;
        const h = vesselHeight;
        const w = vesselWidth * state.V;
        const x = canvas.width / 2 - w / 2;
        const y = 20;
        return {x, y, w, h};
    }
    
    function drawVessel() {
        const bounds = getVesselBounds();
        // Vessel
        ctx.strokeStyle = '#94a3b8';
        ctx.lineWidth = 2;
        ctx.strokeRect(bounds.x, bounds.y, bounds.w, bounds.h);
        // Piston
        ctx.fillStyle = '#334155';
        ctx.fillRect(bounds.x - 10, bounds.y, 10, bounds.h);
        ctx.fillRect(bounds.x + bounds.w, bounds.y, 10, bounds.h);
    }
    
    function drawAgent(agent) {
        ctx.fillStyle = agent.type === 'A' ? 'var(--reactant-color)' : 'var(--product-color)';
        ctx.beginPath();
        ctx.arc(agent.x, agent.y, 6, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // --- Event Handlers ---
    Object.values(inputs).forEach(input => input.addEventListener('input', updateStateFromInputs));
    addA_btn.addEventListener('click', () => {
        for(let i=0; i<10; i++) sim.particles.push(createAgent('A'));
    });
    addB_btn.addEventListener('click', () => {
        for(let i=0; i<10; i++) sim.particles.push(createAgent('B'));
    });
    resetBtn.addEventListener('click', resetSimulation);
    window.addEventListener('resize', resizeCanvas);
    
    resetSimulation();
})();
</script>
</body>
</html>

