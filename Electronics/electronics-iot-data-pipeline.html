<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive IoT Data Pipeline Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-color: #020617; 
            --card-color: rgba(15, 23, 42, 0.7);
            --border-color: #1e293b; 
            --text-light: #e2e8f0;
            --accent-color: #f97316; /* Orange */
            --success-color: #22c55e;
            --fail-color: #ef4444;
        }
        body { background-color: var(--bg-color); color: var(--text-light); font-family: 'Inter', sans-serif; }
        .glass-card { background: var(--card-color); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--border-color); border-radius: 99px; outline: none; transition: background-color 0.2s ease; }
        input[type=range]:hover { background: #334155; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); border: 2px solid var(--text-light);
            cursor: pointer; transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.2);
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.4); }
        .sim-button {
            background: var(--accent-color); color: var(--bg-color);
            transition: all .2s ease; box-shadow: 0 4px 10px rgba(0,0,0,.3);
        }
        .sim-button:hover { background: #fb923c; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,.4); }
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;
            padding-right: 2.5rem; -webkit-appearance: none; -moz-appearance: none; appearance: none;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-amber-400">IoT Data Pipeline Simulator</h1>
            <p class="mt-2 text-slate-400 max-w-2xl mx-auto">Visualize data flow, identify bottlenecks, and analyze the performance of an IoT system.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="glass-card shadow-2xl p-2 rounded-2xl lg:col-span-2">
                <canvas id="simulation-canvas" class="w-full h-[500px] md:h-[600px] rounded-lg"></canvas>
            </div>
            
            <div class="space-y-6">
                 <h2 class="text-2xl font-bold text-center text-slate-300">Pipeline Configuration</h2>
                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                    <h3 class="font-bold text-lg text-orange-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12 20h.01"></path><path d="M12 4h.01"></path><path d="M20 12h.01"></path><path d="M4 12h.01"></path><path d="M17.66 17.66h.01"></path><path d="M6.34 6.34h.01"></path><path d="M17.66 6.34h.01"></path><path d="M6.34 17.66h.01"></path></svg>
                        Sensor & Network
                    </h3>
                    <div class="text-sm space-y-4 pt-2">
                        <div>
                            <label for="sensor-type" class="font-medium text-slate-300">Sensor Type</label>
                            <select id="sensor-type" class="w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white">
                                <option value="steady">Steady (e.g., Temperature)</option>
                                <option value="bursty">Bursty (e.g., Motion)</option>
                            </select>
                        </div>
                        <div>
                            <label for="data-rate" class="font-medium text-slate-300 flex justify-between">Data Rate: <span id="data-rate-val">10 Hz</span></label>
                            <input type="range" id="data-rate" min="1" max="100" value="10">
                        </div>
                        <div>
                            <label for="processing-speed" class="font-medium text-slate-300 flex justify-between">Processing Speed: <span id="processing-speed-val">20 Hz</span></label>
                            <input type="range" id="processing-speed" min="1" max="100" value="20">
                        </div>
                         <div>
                            <label for="latency" class="font-medium text-slate-300 flex justify-between">Network Latency: <span id="latency-val">50 ms</span></label>
                            <input type="range" id="latency" min="10" max="500" value="50">
                        </div>
                    </div>
                </div>

                <div class="glass-card shadow-lg p-5 rounded-2xl space-y-4">
                     <h3 class="font-bold text-lg text-orange-300 flex items-center">
                       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
                        Live Analysis
                    </h3>
                     <div class="text-sm pt-2 space-y-2">
                        <p class="flex justify-between text-slate-400">Throughput: <span id="throughput-val" class="font-mono text-white">0.0 pps</span></p>
                        <p class="flex justify-between text-slate-400">End-to-End Latency: <span id="e2e-latency-val" class="font-mono text-white">0 ms</span></p>
                        <p class="flex justify-between text-slate-400">Packet Loss: <span id="loss-val" class="font-mono font-semibold text-green-400">0.0%</span></p>
                    </div>
                    <div class="flex gap-4 pt-4">
                        <button id="play-pause-btn" class="w-full sim-button font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M8 5v14l11-7z"></path></svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-2 hidden"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                            <span id="play-pause-text">Start</span>
                        </button>
                        <button id="reset-btn" class="w-full bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-slate-700 transition-colors flex items-center justify-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');
    
    const inputs = {
        sensorType: document.getElementById('sensor-type'),
        dataRate: document.getElementById('data-rate'),
        processingSpeed: document.getElementById('processing-speed'),
        latency: document.getElementById('latency'),
    };
    const valueSpans = {
        dataRate: document.getElementById('data-rate-val'),
        processingSpeed: document.getElementById('processing-speed-val'),
        latency: document.getElementById('latency-val'),
    };
     const analysis = {
        throughput: document.getElementById('throughput-val'),
        latency: document.getElementById('e2e-latency-val'),
        loss: document.getElementById('loss-val'),
    };
    
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playPauseText = document.getElementById('play-pause-text');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const resetBtn = document.getElementById('reset-btn');

    let state = { sensorType: 'steady', dataRate: 10, processingSpeed: 20, latency: 50 };
    let sim = { running: false, packets: [], gatewayBuffer: [], cloudBuffer: [], dashboardData: [], totalSent: 0, totalReceived: 0, totalLatency: 0 };
    let rafId = null;
    let time = 0;
    
    const pipelineStages = [
        { name: 'Sensor', x: 0.1 }, { name: 'Gateway', x: 0.3 }, 
        { name: 'Cloud', x: 0.7 }, { name: 'Dashboard', x: 0.9 }
    ];

    function resizeCanvas() {
        const simRect = canvas.parentElement.getBoundingClientRect();
        canvas.width = simRect.width;
        canvas.height = simRect.height > 100 ? simRect.height : 600;
        draw();
    }

    function resetSimulation() {
        if (sim.running) togglePlayPause();
        updateStateFromInputs();
        sim.packets = [];
        sim.gatewayBuffer = [];
        sim.cloudBuffer = [];
        sim.dashboardData = [];
        sim.totalSent = 0;
        sim.totalReceived = 0;
        sim.totalLatency = 0;
        time = 0;
        draw();
    }
    
    function updateStateFromInputs() {
        Object.keys(inputs).forEach(key => {
            state[key] = inputs[key].value;
            if(valueSpans[key]) {
                 valueSpans[key].textContent = `${state[key]} ${key.includes('Rate') || key.includes('Speed') ? 'Hz' : 'ms'}`;
            }
        });
    }

    function physicsStep() {
        time += 16; // ms
        
        // 1. Sensor generates data
        const packetInterval = 1000 / state.dataRate;
        let createPacket = (state.sensorType === 'steady')
            ? (time % packetInterval < 16)
            : (Math.random() < (state.dataRate / 60)); // Bursty
        
        if (createPacket) {
            sim.totalSent++;
            sim.packets.push({ value: Math.random() * 5 + 20, stage: 0, x: canvas.width * 0.1, y: canvas.height * 0.25, ts: time });
        }
        
        // 2. Animate packets
        sim.packets.forEach(p => {
            const targetX = canvas.width * pipelineStages[p.stage + 1].x;
            const speed = (targetX - p.x) / ((state.latency/1000) * 60);
            p.x += speed;
            if (p.x >= targetX) {
                p.stage++;
                p.x = targetX;
                if(p.stage === 1) { // Arrived at Gateway
                    if(sim.gatewayBuffer.length < 50) sim.gatewayBuffer.push(p); else sim.totalSent--; // Packet dropped
                    sim.packets.splice(sim.packets.indexOf(p), 1);
                } else if (p.stage === 2) { // Arrived at Cloud
                    if(sim.cloudBuffer.length < 100) sim.cloudBuffer.push(p); else sim.totalSent--; // Packet dropped
                    sim.packets.splice(sim.packets.indexOf(p), 1);
                } else if (p.stage === 3) { // Arrived at Dashboard
                    sim.totalReceived++;
                    sim.totalLatency += time - p.ts;
                    if(sim.dashboardData.length > 100) sim.dashboardData.shift();
                    sim.dashboardData.push(p.value);
                    sim.packets.splice(sim.packets.indexOf(p), 1);
                }
            }
        });
        
        // 3. Process buffers
        if (sim.gatewayBuffer.length > 0 && Math.random() < 0.8) {
             const p = sim.gatewayBuffer.shift();
             p.x = canvas.width * pipelineStages[1].x;
             sim.packets.push(p);
        }
        
        const processInterval = 1000 / state.processingSpeed;
        if (sim.cloudBuffer.length > 0 && time % processInterval < 16) {
             const p = sim.cloudBuffer.shift();
             p.x = canvas.width * pipelineStages[2].x;
             sim.packets.push(p);
        }
        
        // 4. Update Analysis
        const loss = sim.totalSent > 0 ? (1 - sim.totalReceived / sim.totalSent) * 100 : 0;
        const throughput = sim.totalReceived / (time/1000) || 0;
        const avgLatency = sim.totalReceived > 0 ? sim.totalLatency / sim.totalReceived : 0;
        analysis.loss.textContent = `${loss.toFixed(1)}%`;
        analysis.loss.style.color = loss > 10 ? 'var(--fail-color)' : 'var(--success-color)';
        analysis.throughput.textContent = `${throughput.toFixed(1)} pps`;
        analysis.latency.textContent = `${avgLatency.toFixed(0)} ms`;
    }

    function loop() {
        if (!sim.running) return;
        physicsStep();
        draw();
        rafId = requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawPipeline();
        drawPackets();
        drawDashboard();
    }
    
    function drawPipeline() {
        const cW = canvas.width, cH = canvas.height;
        const pipelineY = cH * 0.25;
        pipelineStages.forEach((stage, i) => {
            const x = cW * stage.x;
            const y = pipelineY;
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(x - 50, y - 20, 100, 40);
            ctx.strokeStyle = '#94a3b8';
            ctx.strokeRect(x - 50, y - 20, 100, 40);
            ctx.fillStyle = '#e2e8f0';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(stage.name, x, y + 5);
            
            if(i < pipelineStages.length - 1) {
                ctx.beginPath();
                ctx.moveTo(x + 50, y);
                ctx.lineTo(cW * pipelineStages[i+1].x - 50, y);
                ctx.stroke();
            }
        });
        
        drawBuffer(cW * 0.3, pipelineY, sim.gatewayBuffer.length, 50);
        drawBuffer(cW * 0.7, pipelineY, sim.cloudBuffer.length, 100);
    }
    
    function drawBuffer(x, y, count, max) {
        const fillRatio = count / max;
        const color = `hsl(${(1-fillRatio) * 120}, 70%, 50%)`;
        ctx.fillStyle = color;
        ctx.fillRect(x - 50, y + 25, 100 * fillRatio, 5);
    }
    
    function drawPackets() {
        sim.packets.forEach(p => {
            ctx.fillStyle = 'var(--accent-color)';
            ctx.beginPath();
            ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    function drawDashboard() {
        const g = { x: 50, y: canvas.height * 0.55, w: canvas.width - 100, h: canvas.height * 0.4 - 20};
        ctx.fillStyle = 'rgba(2, 6, 23, 0.5)';
        ctx.fillRect(g.x, g.y, g.w, g.h);
        ctx.strokeStyle = '#334155';
        ctx.strokeRect(g.x, g.y, g.w, g.h);
        
        ctx.strokeStyle = '#38bdf8';
        ctx.lineWidth = 2;
        ctx.beginPath();
        sim.dashboardData.forEach((d, i) => {
            const x = g.x + (i / 100) * g.w;
            const y = g.y + g.h - ((d - 18) / 10) * g.h; // Assume temp data 18-28 range
             if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        });
        ctx.stroke();

        ctx.fillStyle = '#e2e8f0';
        ctx.font = '12px Inter';
        ctx.textAlign = 'center';
        ctx.fillText('Live Sensor Dashboard', g.x + g.w/2, g.y - 15);
    }
    
    function togglePlayPause() {
        sim.running = !sim.running;
        if (sim.running) {
            playPauseText.textContent = 'Pause';
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            loop();
        } else {
            playPauseText.textContent = 'Start';
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            if(rafId) cancelAnimationFrame(rafId);
        }
    }

    // --- Event Handlers ---
    Object.values(inputs).forEach(input => input.addEventListener('input', () => {
        updateStateFromInputs();
        if(!sim.running) resetSimulation();
    }));
    playPauseBtn.addEventListener('click', togglePlayPause);
    resetBtn.addEventListener('click', resetSimulation);
    
    resetSimulation();
    window.addEventListener('resize', resizeCanvas);
})();
</script>
</body>
</html>

